<html>
    <head>
        <meta charset="UTF-8">
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript">
            function getUrlVars(){
                
                //get URL
                var contentx = unescape(window.location.href);
                //re-replace umlaute
                contentx = contentx.split("#0").join("ä");
                contentx = contentx.split("#1").join("ö");
                contentx = contentx.split("#2").join("ü");
                contentx = contentx.split("#3").join("Ä");
                contentx = contentx.split("#4").join("Ö");
                contentx = contentx.split("#5").join("Ü");
                contentx = contentx.split("#6").join("ß");
                
                //cut first part of url: http://localhost:8080/d3web-ProKEt/js/treemap/treemapVisualisation.html?
                //split the obtaind string by "&"
                //retrun array of stings: explanation for one node in the treemap
                return contentx.slice(contentx.indexOf('?') + 1).split('&');  
            }

            //get middle color for the tree map variables
            function getMiddleColor(){  
                var middle;
                var urlVars = getUrlVars(); //get url 
                middle = urlVars[0].charAt(0)-'0';   //get type for first solution
                for(var i = 1; i < urlVars.length; i++) //for all other rules
                {    
                    if(middle!=(urlVars[i].charAt(0)-'0')){ //compare middle with rest of rules
                        return "#FFFF99";
                    }
                }
                switch(middle){
                    case 0: return "#F28080"; //excluded
                    case 1: return "#DDE8A0"; //suggested
                    case 2: return "#6BF26D"; //established
                    case 3: return "#B7BAB6"; //unclear      
                }
            }

            //get color for treemap table entry
            function getColor(colorInteger){  
                switch(colorInteger){
                    case '0': return -150; //excluded
                    case '1': return 0;    //suggested
                    case '2': return 25;   //established
                    case '3': return 10;   //unclear
                }
            }

            //get header color depending on solution state
            function getHeaderColor(){
                var urlVars = getUrlVars();
                var first = urlVars[0].charAt(0); //is set by the type of the first element
                switch(first){
                    case '0': return "#EB4242"; //excluded
                    case '1': return "#EBF707"; //suggested
                    case '2': return "#7CF56E"; //established
                    case '3': return "#B7BAB6"; //unclear   
                }
        
    
            }
            
            //create data table from url string
            //each row in the table is a solution or the deductive rules for the solution
            //if solution - no parent node
            //if rule - parent is the solution for witch is has been used
            function getTable(){
	
                var urlVars = getUrlVars(); //get url as array
                var parent = urlVars[0].substring(1, urlVars[0].length-1); //get first solution as parent
                var table = new Array();
                table[0] = new Array(); //each table row is a node
                
                //set table header
                table[0][0] = "Solution";
                table[0][1] = "Parent";
                table[0][2] = "Size";
                table[0][3] = "State (color)";
                
                //set first elemnt - root
                table[1] = new Array();
                table[1][0] = parent;
                table[1][1] =  null;
                table[1][2] = 0;
                table[1][3] = 0;

                //set the rest of the table rows
                for(var i = 1; i < urlVars.length; i++){ //for each element in urlVars
                    elem = urlVars[i].split("@"); //split by @ (separated solutin for its rules)
                    color = getColor(elem[0].charAt(0)); //get color - acording to the solution state
    
                    table[i+1] = new Array();
                    table[i+1][0] = elem[0].substr(1, elem[0].length); //set name of node: can be solution name or question with answer
                    table[i+1][1] = elem[1]; //set parent for node
                    
            //set node size according to the solution type:         
            if(elem[0].charAt(0)== "0"){
                table[i+1][2] = 1; //size 1 for excluded
            }else if(elem[0].charAt(0)== "1" || elem[0].charAt(0)== "2"){
                table[i+1][2] = 2; //size 2 for suggested and unclear
            }else if(elem[0].charAt(0)== "3"){
                table[i+1][2] = 5; //size 5 for established
            }
                    
                    table[i+1][3] = color;    //set matching color for node
                }	  

                return table;
            }
 	 
            //load treemap packages from google api
            google.load("visualization", "1", {packages:["treemap"]});
            google.setOnLoadCallback(drawChart);
            
            //drow treemap with the above created table
            function drawChart() {
                // Create and populate the data table.
                var data = google.visualization.arrayToDataTable(getTable());

                // Create and draw the visualization in the div with the id "chart_div"
                var tree = new google.visualization.TreeMap(document.getElementById('chart_div'));
        
                //set treemap variable
                tree.draw(data, {
                    minColor: '#F28080', //red
                    midColor: getMiddleColor(),
                    maxColor: '#6BF26D', //green
                    showScale: true, //show color scale for treemap
                    headerHeight: 25,
                    fontSize: 13,
                    headerColor: getHeaderColor(),
                    fontColor: 'black',
                    maxColorValue: 125,
                    minColorValue: -200
                });
            }
        </script>
    </head>

    <body>
        <!-- create div with id chart_div with costom height and width-->
        <div id="chart_div" style="width: 600px; height: 600px;"></div>
    </body>
</html>